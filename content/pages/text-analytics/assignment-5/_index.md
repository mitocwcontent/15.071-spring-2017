---
content_type: page
parent_title: 5 Text Analytics
parent_uid: 5847ad87-9afe-cf3e-9b93-c20cffe87acf
title: 5.5 Assignment 5
uid: 81eae0fd-28f2-8733-6b79-2210ba33dfbb
---
<ul class="navigation pagination">     <li id="top_bck_btn"><a href="./resolveuid/452a514d74e9b441d73ae42c18939bda">&lt;<span>Video 8: Predictive Coding Today</span></a></li>     <li id="flp_btn_1" class="button_selected"><a href="./resolveuid/81eae0fd28f287336b792210ba33dfbb">5.5.1<span>Separating Spam from Ham (Part 1)</span></a></li>     <li id="flp_btn_2"><a href="./resolveuid/2e4c9dd96d084e8fd1d8111a5affc5a4">5.5.2<span>Detecting Vandalism on Wikipedia</span></a></li>     <li id="flp_btn_3"><a href="./resolveuid/f9baad347f956b6f860866551433d510">5.5.3<span>Automating Reviews in Medicine</span></a></li>     <li id="top_continue_btn"><a href="./resolveuid/2e4c9dd96d084e8fd1d8111a5affc5a4">&gt;<span>Detecting Vandalism on Wikipedia</span></a></li> </ul> <h2 class="subhead">Separating Spam From Ham</h2> <p>Nearly every email user has at some point encountered a &quot;spam&quot; email, which is an unsolicited message often advertising a product, containing links to malware, or attempting to scam the recipient. Roughly 80-90% of more than 100 billion emails sent each day are spam emails, most being sent from botnets of malware-infected computers. The remainder of emails are called &quot;ham&quot; emails.</p> <p>As a result of the huge number of spam emails being sent across the Internet each day, most email providers offer a spam filter that automatically flags likely spam messages and separates them from the ham. Though these filters use a number of techniques (e.g. looking up the sender in a so-called &quot;Blackhole List&quot; that contains IP addresses of likely spammers), most rely heavily on the analysis of the contents of an email via text analytics.</p> <p>In this homework problem, we will build and evaluate a spam filter using a publicly available dataset first described in the 2006 conference paper &quot;Spam Filtering with Naive Bayes &mdash; Which Naive Bayes?&quot; by V. Metsis, I. Androutsopoulos, and G. Paliouras. The &quot;ham&quot; messages in this dataset come from the inbox of former Enron Managing Director for Research Vincent Kaminski, one of the inboxes in the Enron Corpus. One source of spam messages in this dataset is the SpamAssassin corpus, which contains hand-labeled spam messages contributed by Internet users. The remaining spam was collected by Project Honey Pot, a project that collects spam messages and identifies spammers by publishing email address that humans would know not to contact but that bots might target with spam. The full dataset we will use was constructed as roughly a 75/25 mix of the ham and spam messages.</p> <p>The dataset contains just two fields:</p> <ul>     <li><b>text</b>: The text of the email.</li>     <li><b>spam</b>: A binary variable indicating if the email was spam.</li> </ul> <h2 class="subhead">Problem 1.1 - Loading the Dataset</h2> <div class="self_assessment"><p display_name="Problem 1.1 - Loading the Dataset" url_name="Problem_1_1_Loading_the_Dataset_5">Begin by loading the dataset <u><a href="./resolveuid/67f7be241f1b459d7fdb8e9031384338">emails (CSV - 8.5MB)</a></u>&nbsp;into a data frame called emails (don't open the file with Excel; import into R directly to avoid errors). Remember to pass the stringsAsFactors=FALSE option when loading the data.</p> <div id="S1_div" class="problem_solution" tabindex="-1" display_name="Problem 1.1 - Loading the Dataset" url_name="Problem_1_1_Loading_the_Dataset_6">&nbsp;</div> <div id="Q1_div" class="problem_question"><p display_name="Problem 1.1 - Loading the Dataset" url_name="Problem_1_1_Loading_the_Dataset_7">How many emails are in the dataset?</p> <fieldset><legend class="visually-hidden">Exercise 1</legend> <div class="choice"><label id="Q1_label"><span id="Q1_aria_status" tabindex="-1" class="visually-hidden">&amp;nbsp;</span><span class="visually-hidden">Numerical Response</span><input type="text" id="Q1_input" value="" onkeypress="numericTypedOrDropDownSelected(1)" class="problem_text_input" /><input type="hidden" id="Q1_ans" value="5728" /><input type="hidden" id="Q1_tolerance" value="0" /><span id="Q1_normal_status" class="nostatus" aria-hidden="true">&amp;nbsp;</span></label></div> <p id="S1_ans" tabindex="-1" class="problem_answer">&nbsp;</p> </fieldset></div> <div id="S2_div" class="problem_solution" tabindex="-1" display_name="Problem 1.1 - Loading the Dataset" url_name="Problem_1_1_Loading_the_Dataset_9"><div class="detailed-solution"><p>Explanation</p> <p>You can load the dataset with:</p> <p>emails = read.csv(&quot;emails.csv&quot;, stringsAsFactors=FALSE)</p> <p>The number of emails can be read from str(emails) or nrow(emails).</p></div></div> <div class="action"><button id="Q1_button" onclick="checkAnswer({1: 'numerical'})" class="problem_mo_button">Check</button><button id="Q1_button_show" onclick="showHideSolution({1: 'numerical'}, 1, [1, 2])" class="problem_mo_button">Show Answer</button></div></div> <h2 class="subhead">Problem 1.2 - Loading the Dataset</h2> <div class="self_assessment"><div id="Q2_div" class="problem_question"><p display_name="Problem 1.2 - Loading the Dataset" url_name="Problem_1_2_Loading_the_Dataset_4">How many of the emails are spam?</p> <fieldset><legend class="visually-hidden">Exercise 2</legend> <div class="choice"><label id="Q2_label"><span id="Q2_aria_status" tabindex="-1" class="visually-hidden">&amp;nbsp;</span><span class="visually-hidden">Numerical Response</span><input type="text" id="Q2_input" value="" onkeypress="numericTypedOrDropDownSelected(2)" class="problem_text_input" /><input type="hidden" id="Q2_ans" value="1368" /><input type="hidden" id="Q2_tolerance" value="0" /><span id="Q2_normal_status" class="nostatus" aria-hidden="true">&amp;nbsp;</span></label></div> <p id="S2_ans" tabindex="-1" class="problem_answer">&nbsp;</p> </fieldset></div> <div id="S3_div" class="problem_solution" tabindex="-1" display_name="Problem 1.2 - Loading the Dataset" url_name="Problem_1_2_Loading_the_Dataset_6"><div class="detailed-solution"><p>Explanation</p> <p>This can be read from table(emails$spam).</p></div></div> <div class="action"><button id="Q2_button" onclick="checkAnswer({2: 'numerical'})" class="problem_mo_button">Check</button><button id="Q2_button_show" onclick="showHideSolution({2: 'numerical'}, 2, [3])" class="problem_mo_button">Show Answer</button></div></div> <h2 class="subhead">Problem 1.3 - Loading the Dataset</h2> <div class="self_assessment"><div id="Q3_div" class="problem_question"><p display_name="Problem 1.3 - Loading the Dataset" url_name="Problem_1_3_Loading_the_Dataset_0">Which word appears at the beginning of every email in the dataset? Respond as a lower-case word with punctuation removed.</p> <fieldset><legend class="visually-hidden">Exercise 3</legend> <div class="choice"><label id="Q3_label"><span id="Q3_aria_status" tabindex="-1" class="visually-hidden">&amp;nbsp;</span><span class="visually-hidden">Text Response</span><input ckecktype="ci" onkeypress="numericTypedOrDropDownSelected(3)" value="" answer="subject" type="text" id="Q3_input" class="problem_text_input" /><span id="Q3_normal_status" class="nostatus" aria-hidden="true">&amp;nbsp;</span><span style="display:none;" id="Q3_ans_span" tabindex="-1" class="answer">  Answer:subject</span></label></div> </fieldset></div> <div id="S4_div" class="problem_solution" tabindex="-1" display_name="Problem 1.3 - Loading the Dataset" url_name="Problem_1_3_Loading_the_Dataset_2"><div class="detailed-solution"><p>Explanation</p> <p>You can review emails with, for instance, emails$text[1] or emails$text[1000]. Every email begins with the word &quot;Subject:&quot;.</p></div></div> <div class="action"><button id="Q3_button" onclick="checkAnswer({3: 'stringresponse'})" class="problem_mo_button">Check</button><button id="Q3_button_show" onclick="showHideSolution({3: 'stringresponse'}, 3, [4])" class="problem_mo_button">Show Answer</button></div></div> <h2 class="subhead">Problem 1.4 - Loading the Dataset</h2> <div class="self_assessment"><div id="Q4_div" class="problem_question"><p display_name="Problem 1.4 - Loading the Dataset" url_name="Problem_1_4_Loading_the_Dataset_0">Could a spam classifier potentially benefit from including the frequency of the word that appears in every email?</p> <fieldset><legend class="visually-hidden">Exercise 4</legend> <div class="choice"><label id="Q4_input_1_label"><span id="Q4_input_1_aria_status" tabindex="-1" class="visually-hidden">&amp;nbsp;</span><input type="radio" id="Q4_input_1" onclick="optionSelected(4)" name="Q4_input" class="problem_radio_input" correct="false" /><span class="choice">No -- the word appears in every email so this variable would not help us differentiate spam from ham.</span><span id="Q4_input_1_normal_status" class="nostatus" aria-hidden="true">&amp;nbsp;</span></label></div> <div class="choice"><label id="Q4_input_2_label"><span id="Q4_input_2_aria_status" tabindex="-1" class="visually-hidden">&amp;nbsp;</span><input type="radio" id="Q4_input_2" onclick="optionSelected(4)" name="Q4_input" class="problem_radio_input" correct="true" /><span class="choice">Yes -- the number of times the word appears might help us differentiate spam from ham.</span><span id="Q4_input_2_normal_status" class="nostatus" aria-hidden="true">&amp;nbsp;</span></label></div> </fieldset></div> <div id="S5_div" class="problem_solution" tabindex="-1" display_name="Problem 1.4 - Loading the Dataset" url_name="Problem_1_4_Loading_the_Dataset_2"><div class="detailed-solution"><p>Explanation</p> <p>We know that each email has the word &quot;subject&quot; appear at least once, but the frequency with which it appears might help us differentiate spam from ham. For instance, a long email chain would have the word &quot;subject&quot; appear a number of times, and this higher frequency might be indicative of a ham message.</p></div></div> <div class="action"><button id="Q4_button" onclick="checkAnswer({4: 'multiple_choice'})" class="problem_mo_button">Check</button><button id="Q4_button_show" onclick="showHideSolution({4: 'multiple_choice'}, 4, [5])" class="problem_mo_button">Show Answer</button></div></div> <h2 class="subhead">Problem 1.5 - Loading the Dataset</h2> <div class="self_assessment"><div id="Q5_div" class="problem_question"><p display_name="Problem 1.5 - Loading the Dataset" url_name="Problem_1_5_Loading_the_Dataset_0">The nchar() function counts the number of characters in a piece of text. How many characters are in the longest email in the dataset (where longest is measured in terms of the maximum number of characters)?</p> <fieldset><legend class="visually-hidden">Exercise 5</legend> <div class="choice"><label id="Q5_label"><span id="Q5_aria_status" tabindex="-1" class="visually-hidden">&amp;nbsp;</span><span class="visually-hidden">Numerical Response</span><input type="text" id="Q5_input" value="" onkeypress="numericTypedOrDropDownSelected(5)" class="problem_text_input" /><input type="hidden" id="Q5_ans" value="43952" /><input type="hidden" id="Q5_tolerance" value="5" /><span id="Q5_normal_status" class="nostatus" aria-hidden="true">&amp;nbsp;</span></label></div> <p id="S5_ans" tabindex="-1" class="problem_answer">&nbsp;</p> </fieldset></div> <div id="S6_div" class="problem_solution" tabindex="-1" display_name="Problem 1.5 - Loading the Dataset" url_name="Problem_1_5_Loading_the_Dataset_2"><div class="detailed-solution"><p>Explanation</p> <p>The maximum length can be obtained with max(nchar(emails$text)).</p></div></div> <div class="action"><button id="Q5_button" onclick="checkAnswer({5: 'numerical'})" class="problem_mo_button">Check</button><button id="Q5_button_show" onclick="showHideSolution({5: 'numerical'}, 5, [6])" class="problem_mo_button">Show Answer</button></div></div> <h2 class="subhead">Problem 2.1 - Preparing the Corpus</h2> <div class="self_assessment"><p display_name="Problem 2.1 - Preparing the Corpus" url_name="Problem_2_1_Preparing_the_Corpus_0">Follow the standard steps to build and pre-process the corpus:</p> <p display_name="Problem 2.1 - Preparing the Corpus" url_name="Problem_2_1_Preparing_the_Corpus_1">1) Build a new corpus variable called corpus.</p> <p display_name="Problem 2.1 - Preparing the Corpus" url_name="Problem_2_1_Preparing_the_Corpus_2">2) Using tm_map, convert the text to lowercase.</p> <p display_name="Problem 2.1 - Preparing the Corpus" url_name="Problem_2_1_Preparing_the_Corpus_3">3) Using tm_map, remove all punctuation from the corpus.</p> <p display_name="Problem 2.1 - Preparing the Corpus" url_name="Problem_2_1_Preparing_the_Corpus_4">4) Using tm_map, remove all English stopwords from the corpus.</p> <p display_name="Problem 2.1 - Preparing the Corpus" url_name="Problem_2_1_Preparing_the_Corpus_5">5) Using tm_map, stem the words in the corpus.</p> <p display_name="Problem 2.1 - Preparing the Corpus" url_name="Problem_2_1_Preparing_the_Corpus_6">6) Build a document term matrix from the corpus, called dtm.</p> <p display_name="Problem 2.1 - Preparing the Corpus" url_name="Problem_2_1_Preparing_the_Corpus_7">If the code length(stopwords(&quot;english&quot;)) does not return 174 for you, then please run the line of code in&nbsp;<u><a href="./resolveuid/bcb87bd6e9ec8d828a362298d36363f5">stopwords (TXT) file</a></u>, which will store the standard stop words in a variable called sw. When removing stop words, use tm_map(corpus, removeWords, sw) instead of tm_map(corpus, removeWords, stopwords(&quot;english&quot;)).</p> <div id="Q6_div" class="problem_question"><p display_name="Problem 2.1 - Preparing the Corpus" url_name="Problem_2_1_Preparing_the_Corpus_8">How many terms are in dtm?</p> <fieldset><legend class="visually-hidden">Exercise 6</legend> <div class="choice"><label id="Q6_label"><span id="Q6_aria_status" tabindex="-1" class="visually-hidden">&amp;nbsp;</span><span class="visually-hidden">Numerical Response</span><input type="text" id="Q6_input" value="" onkeypress="numericTypedOrDropDownSelected(6)" class="problem_text_input" /><input type="hidden" id="Q6_ans" value="28687" /><input type="hidden" id="Q6_tolerance" value="0" /><span id="Q6_normal_status" class="nostatus" aria-hidden="true">&amp;nbsp;</span></label></div> <p id="S6_ans" tabindex="-1" class="problem_answer">&nbsp;</p> </fieldset></div> <div id="S7_div" class="problem_solution" tabindex="-1" display_name="Problem 2.1 - Preparing the Corpus" url_name="Problem_2_1_Preparing_the_Corpus_10"><div class="detailed-solution"><p>Explanation</p> <p>These steps can be accomplished by running:</p> <p>library(tm)</p> <p>corpus = Corpus(VectorSource(emails$text))</p> <p>corpus = tm_map(corpus, tolower)</p> <p>corpus = tm_map(corpus, PlainTextDocument)</p> <p>corpus = tm_map(corpus, removePunctuation)</p> <p>corpus = tm_map(corpus, removeWords, stopwords(&quot;english&quot;))</p> <p>corpus = tm_map(corpus, stemDocument)</p> <p>dtm = DocumentTermMatrix(corpus)</p> <p>dtm</p> <p>From the dtm summary output, we can read that it contains 28687 terms.</p></div></div> <div class="action"><button id="Q6_button" onclick="checkAnswer({6: 'numerical'})" class="problem_mo_button">Check</button><button id="Q6_button_show" onclick="showHideSolution({6: 'numerical'}, 6, [7])" class="problem_mo_button">Show Answer</button></div></div> <h2 class="subhead">Problem 2.2 - Preparing the Corpus</h2> <div class="self_assessment"><div id="Q7_div" class="problem_question"><p display_name="Problem 2.2 - Preparing the Corpus" url_name="Problem_2_2_Preparing_the_Corpus_0">To obtain a more reasonable number of terms, limit dtm to contain terms appearing in at least 5% of documents, and store this result as spdtm (don't overwrite dtm, because we will use it in a later step of this homework). How many terms are in spdtm?</p> <fieldset><legend class="visually-hidden">Exercise 7</legend> <div class="choice"><label id="Q7_label"><span id="Q7_aria_status" tabindex="-1" class="visually-hidden">&amp;nbsp;</span><span class="visually-hidden">Numerical Response</span><input type="text" id="Q7_input" value="" onkeypress="numericTypedOrDropDownSelected(7)" class="problem_text_input" /><input type="hidden" id="Q7_ans" value="330" /><input type="hidden" id="Q7_tolerance" value="0" /><span id="Q7_normal_status" class="nostatus" aria-hidden="true">&amp;nbsp;</span></label></div> <p id="S7_ans" tabindex="-1" class="problem_answer">&nbsp;</p> </fieldset></div> <div id="S8_div" class="problem_solution" tabindex="-1" display_name="Problem 2.2 - Preparing the Corpus" url_name="Problem_2_2_Preparing_the_Corpus_2"><div class="detailed-solution"><p>Explanation</p> <p>This can be accomplished with:</p> <p>spdtm = removeSparseTerms(dtm, 0.95)</p> <p>spdtm</p> <p>From the spdtm summary output, it contains 330 terms.</p></div></div> <div class="action"><button id="Q7_button" onclick="checkAnswer({7: 'numerical'})" class="problem_mo_button">Check</button><button id="Q7_button_show" onclick="showHideSolution({7: 'numerical'}, 7, [8])" class="problem_mo_button">Show Answer</button></div></div> <h2 class="subhead">Problem 3.1 - Building machine learning models</h2> <div class="self_assessment"><p display_name="Problem 3.1 - Building machine learning models" url_name="Problem_3_1_Building_machine_learning_models_0">First, create a variable called &quot;emailsSparse&quot; from &quot;spdtm&quot; using the command &quot;emailsSparse = as.data.frame(as.matrix(spdtm))&quot; and ensure it has legal variable names with &quot;names(emailsSparse) = make.names(names(emailsSparse))&quot;. Then, copy the dependent variable from the original data frame called &quot;emails&quot; to  &quot;emailsSparse&quot; using the command &quot;emailsSparse$spam = as.factor(emails$spam)&quot;.</p> <p display_name="Problem 3.1 - Building machine learning models" url_name="Problem_3_1_Building_machine_learning_models_1">Next, set the random seed to 123 and use the sample.split function to split emailsSparse 70/30 into a training set called &quot;train&quot; and a testing set called &quot;test&quot;. Make sure to perform this step on emailsSparse instead of emails.</p> <div id="S9_div" class="problem_solution" tabindex="-1" display_name="Problem 3.1 - Building machine learning models" url_name="Problem_3_1_Building_machine_learning_models_2"><div class="detailed-solution"><p>Explanation</p> <p>These steps can be accomplished with:</p> <p>emailsSparse = as.data.frame(as.matrix(spdtm))</p> <p>names(emailsSparse) = make.names(names(emailsSparse))</p> <p>emailsSparse$spam = as.factor(emails$spam)</p> <p>set.seed(123)</p> <p>library(caTools)</p> <p>spl = sample.split(emailsSparse$spam, 0.7)</p> <p>library(dplyr)</p> <p>train = emailsSparse %&gt;% filter(spl == TRUE)</p> <p>test = emailsSparse %&gt;% filter(spl == FALSE)</p></div></div> <p display_name="Problem 3.1 - Building machine learning models" url_name="Problem_3_1_Building_machine_learning_models_3">Using the training set, train the following two machine learning models. The models should predict the dependent variable &quot;spam&quot;, using all other available variables as independent variables. Please be patient, as these models may take a few minutes to train.</p> <p display_name="Problem 3.1 - Building machine learning models" url_name="Problem_3_1_Building_machine_learning_models_4">1) A CART model called spamCART, using the default parameters to train the model (don't worry about adding minbucket or cp or specifying losses for false positives and false negatives). Remember to add the argument method=&quot;class&quot; since this is a binary classification problem.</p> <p display_name="Problem 3.1 - Building machine learning models" url_name="Problem_3_1_Building_machine_learning_models_5">2) A random forest model called spamRF, using the default parameters to train the model (don't worry about specifying mtry or ntree or nodesize or the losses for false positives and false negatives). Directly before training the random forest model, set the random seed to 123 (even though we've already done this earlier in the problem, it's important to set the seed right before training the model so we all obtain the same results. Keep in mind though that on certain operating systems, your results might still be slightly different).</p> <div id="S10_div" class="problem_solution" tabindex="-1" display_name="Problem 3.1 - Building machine learning models" url_name="Problem_3_1_Building_machine_learning_models_6"><div class="detailed-solution"><p>Explanation</p> <p>These models can be trained with the following code:</p> <p>library(rpart)</p> <p>spamCART = rpart(spam~., data=train, method=&quot;class&quot;)</p> <p>set.seed(123)</p> <p>library(randomForest)</p> <p>spamRF = randomForest(spam~., data=train)</p></div></div> <p display_name="Problem 3.1 - Building machine learning models" url_name="Problem_3_1_Building_machine_learning_models_7">Similar to logistic regression, CART and random forest can be told to give you predicted probabilities for classification problems. CART does this by returning the proportion of observations in the bucket of interest that fall into the relevant category, and random forest does this by returning the proportion of the trees that predict the relevant category. The following commands can be used to obtain predicted probabilities for the two fitted models on the training set:</p> <p display_name="Problem 3.1 - Building machine learning models" url_name="Problem_3_1_Building_machine_learning_models_8">predTrainCART = predict(spamCART)[,2]</p> <p display_name="Problem 3.1 - Building machine learning models" url_name="Problem_3_1_Building_machine_learning_models_9">predTrainRF = predict(spamRF, type=&quot;prob&quot;)[,2]</p> <div id="Q8_div" class="problem_question"><p display_name="Problem 3.1 - Building machine learning models" url_name="Problem_3_1_Building_machine_learning_models_10">What is the training set accuracy of spamCART, using a threshold of 0.5 for predictions?</p> <fieldset><legend class="visually-hidden">Exercise 8</legend> <div class="choice"><label id="Q8_label"><span id="Q8_aria_status" tabindex="-1" class="visually-hidden">&amp;nbsp;</span><span class="visually-hidden">Numerical Response</span><input type="text" id="Q8_input" value="" onkeypress="numericTypedOrDropDownSelected(8)" class="problem_text_input" /><input type="hidden" id="Q8_ans" value="0.942394" /><input type="hidden" id="Q8_tolerance" value="0.02" /><span id="Q8_normal_status" class="nostatus" aria-hidden="true">&amp;nbsp;</span></label></div> <p id="S8_ans" tabindex="-1" class="problem_answer">&nbsp;</p> </fieldset></div> <div id="S11_div" class="problem_solution" tabindex="-1" display_name="Problem 3.1 - Building machine learning models" url_name="Problem_3_1_Building_machine_learning_models_12"><div class="detailed-solution"><p>Explanation</p> <p>This can be obtained with:</p> <p>table(train$spam, predTrainCART &gt; 0.5)</p> <p>Then the accuracy is (2885+894)/nrow(train)</p></div></div> <div id="Q9_div" class="problem_question"><p display_name="Problem 3.1 - Building machine learning models" url_name="Problem_3_1_Building_machine_learning_models_13">What is the training set accuracy of spamRF, using a threshold of 0.5 for predictions? (Remember that your answer might not match ours exactly, due to random behavior in the random forest algorithm on different operating systems.)</p> <fieldset><legend class="visually-hidden">Exercise 9</legend> <div class="choice"><label id="Q9_label"><span id="Q9_aria_status" tabindex="-1" class="visually-hidden">&amp;nbsp;</span><span class="visually-hidden">Numerical Response</span><input type="text" id="Q9_input" value="" onkeypress="numericTypedOrDropDownSelected(9)" class="problem_text_input" /><input type="hidden" id="Q9_ans" value="0.9793017" /><input type="hidden" id="Q9_tolerance" value="0.05" /><span id="Q9_normal_status" class="nostatus" aria-hidden="true">&amp;nbsp;</span></label></div> <p id="S9_ans" tabindex="-1" class="problem_answer">&nbsp;</p> </fieldset></div> <div id="S12_div" class="problem_solution" tabindex="-1" display_name="Problem 3.1 - Building machine learning models" url_name="Problem_3_1_Building_machine_learning_models_15"><div class="detailed-solution"><p>Explanation</p> <p>This can be obtained with:</p> <p>table(train$spam, predTrainRF &gt; 0.5)</p> <p>And then the accuracy is (3013+914)/nrow(train)</p></div></div> <div class="action"><button id="Q8_button" onclick="checkAnswer({8: 'numerical', 9: 'numerical'})" class="problem_mo_button">Check</button><button id="Q8_button_show" onclick="showHideSolution({8: 'numerical', 9: 'numerical'}, 8, [9, 10, 11, 12])" class="problem_mo_button">Show Answer</button></div></div> <h2 class="subhead">Problem 3.2 - Building Machine Learning Models</h2> <div class="self_assessment"><div id="Q10_div" class="problem_question"><p display_name="Problem 3.2 - Building Machine Learning Models" url_name="Problem_3_2_Building_Machine_Learning_Models_0">How many of the word stems &quot;enron&quot;, &quot;hou&quot;, &quot;vinc&quot;, and &quot;kaminski&quot; appear in the CART tree? These are word stems likely specific to the inbox of Vincent Kaminski, whose email we used as the ham observations in our dataset.</p> <fieldset><legend class="visually-hidden">Exercise 10</legend> <div class="choice"><label id="Q10_label"><span id="Q10_aria_status" tabindex="-1" class="visually-hidden">&amp;nbsp;</span><span class="visually-hidden">Numerical Response</span><input type="text" id="Q10_input" value="" onkeypress="numericTypedOrDropDownSelected(10)" class="problem_text_input" /><input type="hidden" id="Q10_ans" value="2" /><input type="hidden" id="Q10_tolerance" value="0" /><span id="Q10_normal_status" class="nostatus" aria-hidden="true">&amp;nbsp;</span></label></div> <p id="S10_ans" tabindex="-1" class="problem_answer">&nbsp;</p> </fieldset></div> <div id="S13_div" class="problem_solution" tabindex="-1" display_name="Problem 3.2 - Building Machine Learning Models" url_name="Problem_3_2_Building_Machine_Learning_Models_2"><div class="detailed-solution"><p>Explanation</p> <p>After loading the necessary package with &quot;library(rpart.plot)&quot;, we see from &quot;prp(spamCART)&quot; that &quot;vinc&quot; and &quot;enron&quot; appear in the CART tree as the top two branches, but that &quot;hou&quot; and &quot;kaminski&quot; do not appear.</p></div></div> <div class="action"><button id="Q9_button" onclick="checkAnswer({10: 'numerical'})" class="problem_mo_button">Check</button><button id="Q9_button_show" onclick="showHideSolution({10: 'numerical'}, 9, [13])" class="problem_mo_button">Show Answer</button></div></div> <h2 class="subhead">Problem 3.3 - Building Machine Learning Models</h2> <div class="self_assessment"><div id="Q11_div" class="problem_question"><p display_name="Problem 3.3 - Building Machine Learning Models" url_name="Problem_3_3_Building_Machine_Learning_Models_0">What is the training set AUC of spamCART? Note that now that we have predicted probabilities from the CART model, we can compute AUC with the ROCR package just as we have for logistic regression.</p> <fieldset><legend class="visually-hidden">Exercise 11</legend> <div class="choice"><label id="Q11_label"><span id="Q11_aria_status" tabindex="-1" class="visually-hidden">&amp;nbsp;</span><span class="visually-hidden">Numerical Response</span><input type="text" id="Q11_input" value="" onkeypress="numericTypedOrDropDownSelected(11)" class="problem_text_input" /><input type="hidden" id="Q11_ans" value="0.9696044" /><input type="hidden" id="Q11_tolerance" value="1%" /><span id="Q11_normal_status" class="nostatus" aria-hidden="true">&amp;nbsp;</span></label></div> <p id="S11_ans" tabindex="-1" class="problem_answer">&nbsp;</p> </fieldset></div> <div id="S14_div" class="problem_solution" tabindex="-1" display_name="Problem 3.3 - Building Machine Learning Models" url_name="Problem_3_3_Building_Machine_Learning_Models_2"><div class="detailed-solution"><p>Explanation</p> <p>This can be obtained with:</p> <p>library(ROCR)</p> <p>predictionTrainCART = prediction(predTrainCART, train$spam)</p> <p>as.numeric(performance(predictionTrainCART, &quot;auc&quot;)@y.values)</p></div></div> <div class="action"><button id="Q10_button" onclick="checkAnswer({11: 'numerical'})" class="problem_mo_button">Check</button><button id="Q10_button_show" onclick="showHideSolution({11: 'numerical'}, 10, [14])" class="problem_mo_button">Show Answer</button></div></div> <h2 class="subhead">Problem 3.4 - Building Machine Learning Models</h2> <div class="self_assessment"><div id="Q12_div" class="problem_question"><p display_name="Problem 3.4 - Building Machine Learning Models" url_name="Problem_3_4_Building_Machine_Learning_Models_0">What is the training set AUC of spamRF?</p> <fieldset><legend class="visually-hidden">Exercise 12</legend> <div class="choice"><label id="Q12_label"><span id="Q12_aria_status" tabindex="-1" class="visually-hidden">&amp;nbsp;</span><span class="visually-hidden">Numerical Response</span><input type="text" id="Q12_input" value="" onkeypress="numericTypedOrDropDownSelected(12)" class="problem_text_input" /><input type="hidden" id="Q12_ans" value="0.9979116" /><input type="hidden" id="Q12_tolerance" value="0.05" /><span id="Q12_normal_status" class="nostatus" aria-hidden="true">&amp;nbsp;</span></label></div> <p id="S12_ans" tabindex="-1" class="problem_answer">&nbsp;</p> </fieldset></div> <div id="S15_div" class="problem_solution" tabindex="-1" display_name="Problem 3.4 - Building Machine Learning Models" url_name="Problem_3_4_Building_Machine_Learning_Models_2"><div class="detailed-solution"><p>Explanation</p> <p>This can be obtained with:</p> <p>predictionTrainRF = prediction(predTrainRF, train$spam)</p> <p>as.numeric(performance(predictionTrainRF, &quot;auc&quot;)@y.values)</p></div></div> <div class="action"><button id="Q11_button" onclick="checkAnswer({12: 'numerical'})" class="problem_mo_button">Check</button><button id="Q11_button_show" onclick="showHideSolution({12: 'numerical'}, 11, [15])" class="problem_mo_button">Show Answer</button></div></div> <h2 class="subhead">Problem 4.1 - Evaluating on the Test Set</h2> <div class="self_assessment"><p display_name="Problem 4.1 - Evaluating on the Test Set" url_name="Problem_4_1_Evaluating_on_the_Test_Set_0">Obtain predicted probabilities for the testing set for each of the models, again ensuring that probabilities instead of classes are obtained. This can be achieved with the following code:</p> <p display_name="Problem 4.1 - Evaluating on the Test Set" url_name="Problem_4_1_Evaluating_on_the_Test_Set_1">predTestCART = predict(spamCART, newdata=test)[,2]</p> <p display_name="Problem 4.1 - Evaluating on the Test Set" url_name="Problem_4_1_Evaluating_on_the_Test_Set_2">predTestRF = predict(spamRF, newdata=test, type=&quot;prob&quot;)[,2]</p> <div id="Q13_div" class="problem_question"><p display_name="Problem 4.1 - Evaluating on the Test Set" url_name="Problem_4_1_Evaluating_on_the_Test_Set_3">What is the testing set accuracy of spamCART, using a threshold of 0.5 for predictions?</p> <fieldset><legend class="visually-hidden">Exercise 13</legend> <div class="choice"><label id="Q13_label"><span id="Q13_aria_status" tabindex="-1" class="visually-hidden">&amp;nbsp;</span><span class="visually-hidden">Numerical Response</span><input type="text" id="Q13_input" value="" onkeypress="numericTypedOrDropDownSelected(13)" class="problem_text_input" /><input type="hidden" id="Q13_ans" value="0.9394645" /><input type="hidden" id="Q13_tolerance" value="1%" /><span id="Q13_normal_status" class="nostatus" aria-hidden="true">&amp;nbsp;</span></label></div> <p id="S13_ans" tabindex="-1" class="problem_answer">&nbsp;</p> </fieldset></div> <div id="S16_div" class="problem_solution" tabindex="-1" display_name="Problem 4.1 - Evaluating on the Test Set" url_name="Problem_4_1_Evaluating_on_the_Test_Set_5"><div class="detailed-solution"><p>Explanation</p> <p>This can be obtained with:</p> <p>table(test$spam, predTestCART &gt; 0.5)</p> <p>Then the accuracy is (1228+386)/nrow(test)</p></div></div> <div class="action"><button id="Q12_button" onclick="checkAnswer({13: 'numerical'})" class="problem_mo_button">Check</button><button id="Q12_button_show" onclick="showHideSolution({13: 'numerical'}, 12, [16])" class="problem_mo_button">Show Answer</button></div></div> <h2 class="subhead">Problem 4.2 - Evaluating on the Test Set</h2> <div class="self_assessment"><div id="Q14_div" class="problem_question"><p display_name="Problem 4.2 - Evaluating on the Test Set" url_name="Problem_4_2_Evaluating_on_the_Test_Set_0">What is the testing set AUC of spamCART?</p> <fieldset><legend class="visually-hidden">Exercise 14</legend> <div class="choice"><label id="Q14_label"><span id="Q14_aria_status" tabindex="-1" class="visually-hidden">&amp;nbsp;</span><span class="visually-hidden">Numerical Response</span><input type="text" id="Q14_input" value="" onkeypress="numericTypedOrDropDownSelected(14)" class="problem_text_input" /><input type="hidden" id="Q14_ans" value="0.963176" /><input type="hidden" id="Q14_tolerance" value="1%" /><span id="Q14_normal_status" class="nostatus" aria-hidden="true">&amp;nbsp;</span></label></div> <p id="S14_ans" tabindex="-1" class="problem_answer">&nbsp;</p> </fieldset></div> <div id="S17_div" class="problem_solution" tabindex="-1" display_name="Problem 4.2 - Evaluating on the Test Set" url_name="Problem_4_2_Evaluating_on_the_Test_Set_2"><div class="detailed-solution"><p>Explanation</p> <p>This can be obtained with:</p> <p>predictionTestCART = prediction(predTestCART, test$spam)</p> <p>as.numeric(performance(predictionTestCART, &quot;auc&quot;)@y.values)</p></div></div> <div class="action"><button id="Q13_button" onclick="checkAnswer({14: 'numerical'})" class="problem_mo_button">Check</button><button id="Q13_button_show" onclick="showHideSolution({14: 'numerical'}, 13, [17])" class="problem_mo_button">Show Answer</button></div></div> <h2 class="subhead">Problem 4.3 - Evaluating on the Test Set</h2> <div class="self_assessment"><div id="Q15_div" class="problem_question"><p display_name="Problem 4.3 - Evaluating on the Test Set" url_name="Problem_4_3_Evaluating_on_the_Test_Set_0">What is the testing set accuracy of spamRF, using a threshold of 0.5 for predictions?</p> <fieldset><legend class="visually-hidden">Exercise 15</legend> <div class="choice"><label id="Q15_label"><span id="Q15_aria_status" tabindex="-1" class="visually-hidden">&amp;nbsp;</span><span class="visually-hidden">Numerical Response</span><input type="text" id="Q15_input" value="" onkeypress="numericTypedOrDropDownSelected(15)" class="problem_text_input" /><input type="hidden" id="Q15_ans" value="0.9749709" /><input type="hidden" id="Q15_tolerance" value="0.05" /><span id="Q15_normal_status" class="nostatus" aria-hidden="true">&amp;nbsp;</span></label></div> <p id="S15_ans" tabindex="-1" class="problem_answer">&nbsp;</p> </fieldset></div> <div id="S18_div" class="problem_solution" tabindex="-1" display_name="Problem 4.3 - Evaluating on the Test Set" url_name="Problem_4_3_Evaluating_on_the_Test_Set_2"><div class="detailed-solution"><p>Explanation</p> <p>This can be obtained with:</p> <p>table(test$spam, predTestRF &gt; 0.5)</p> <p>Then the accuracy is (1290+385)/nrow(test)</p></div></div> <div class="action"><button id="Q14_button" onclick="checkAnswer({15: 'numerical'})" class="problem_mo_button">Check</button><button id="Q14_button_show" onclick="showHideSolution({15: 'numerical'}, 14, [18])" class="problem_mo_button">Show Answer</button></div></div> <h2 class="subhead">Problem 4.4 - Evaluating on the Test Set</h2> <div class="self_assessment"><div id="Q16_div" class="problem_question"><p display_name="Problem 4.4 - Evaluating on the Test Set" url_name="Problem_4_4_Evaluating_on_the_Test_Set_0">What is the testing set AUC of spamRF?</p> <fieldset><legend class="visually-hidden">Exercise 16</legend> <div class="choice"><label id="Q16_label"><span id="Q16_aria_status" tabindex="-1" class="visually-hidden">&amp;nbsp;</span><span class="visually-hidden">Numerical Response</span><input type="text" id="Q16_input" value="" onkeypress="numericTypedOrDropDownSelected(16)" class="problem_text_input" /><input type="hidden" id="Q16_ans" value="0.9975656" /><input type="hidden" id="Q16_tolerance" value="0.05" /><span id="Q16_normal_status" class="nostatus" aria-hidden="true">&amp;nbsp;</span></label></div> <p id="S16_ans" tabindex="-1" class="problem_answer">&nbsp;</p> </fieldset></div> <div id="S19_div" class="problem_solution" tabindex="-1" display_name="Problem 4.4 - Evaluating on the Test Set" url_name="Problem_4_4_Evaluating_on_the_Test_Set_2"><div class="detailed-solution"><p>Explanation</p> <p>This can be obtained with:</p> <p>predictionTestRF = prediction(predTestRF, test$spam)</p> <p>as.numeric(performance(predictionTestRF, &quot;auc&quot;)@y.values)</p></div></div> <div class="action"><button id="Q15_button" onclick="checkAnswer({16: 'numerical'})" class="problem_mo_button">Check</button><button id="Q15_button_show" onclick="showHideSolution({16: 'numerical'}, 15, [19])" class="problem_mo_button">Show Answer</button></div></div> <h2 class="subhead">Problem 4.5 - Evaluating on the Test Set</h2> <div class="self_assessment"><div id="Q17_div" class="problem_question"><p display_name="Problem 4.5 - Evaluating on the Test Set" url_name="Problem_4_5_Evaluating_on_the_Test_Set_0">Which model had the best testing set performance, in terms of accuracy and AUC?</p> <fieldset><legend class="visually-hidden">Exercise 17</legend> <div class="choice"><label id="Q17_input_1_label"><span id="Q17_input_1_aria_status" tabindex="-1" class="visually-hidden">&amp;nbsp;</span><input type="radio" id="Q17_input_1" onclick="optionSelected(17)" name="Q17_input" class="problem_radio_input" correct="false" /><span class="choice">CART</span><span id="Q17_input_1_normal_status" class="nostatus" aria-hidden="true">&amp;nbsp;</span></label></div> <div class="choice"><label id="Q17_input_2_label"><span id="Q17_input_2_aria_status" tabindex="-1" class="visually-hidden">&amp;nbsp;</span><input type="radio" id="Q17_input_2" onclick="optionSelected(17)" name="Q17_input" class="problem_radio_input" correct="true" /><span class="choice">Random forest</span><span id="Q17_input_2_normal_status" class="nostatus" aria-hidden="true">&amp;nbsp;</span></label></div> </fieldset></div> <div id="S20_div" class="problem_solution" tabindex="-1" display_name="Problem 4.5 - Evaluating on the Test Set" url_name="Problem_4_5_Evaluating_on_the_Test_Set_2"><div class="detailed-solution"><p>Explanation</p> <p>The random forest outperformed CART in both measures, obtaining an impressive AUC of 0.998 on the test set.</p></div></div> <div class="action"><button id="Q16_button" onclick="checkAnswer({17: 'multiple_choice'})" class="problem_mo_button">Check</button><button id="Q16_button_show" onclick="showHideSolution({17: 'multiple_choice'}, 16, [20])" class="problem_mo_button">Show Answer</button></div></div> <p>&nbsp;</p> <p>You may note that we did not ask you to&nbsp;fit a logistic regression model to predict whether an email was spam or ham. This is in contrast to our usual approach of comparing all three models. If you in fact&nbsp;tried to train a logistic regression model in R using this dataset, you would get the following warning:</p> <p><strong>glm.fit: algorithm did not converge&nbsp;</strong></p> <p>This warning indicates that R's&nbsp;logistic regression solution procedure has failed.</p> <ul class="navigation progress">     <li id="bck_btn"><a href="./resolveuid/452a514d74e9b441d73ae42c18939bda">Back<span>Video 8: Predictive Coding Today</span></a></li>     <li id="continue_btn"><a href="./resolveuid/2e4c9dd96d084e8fd1d8111a5affc5a4">Continue<span>Detecting Vandalism on Wikipedia</span></a></li> </ul> <p>&nbsp;</p>